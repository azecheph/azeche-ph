<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargar Propietarios a Firebase</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #0056B8 0%, #00B853 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 86, 184, 0.3);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        #log {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.5;
            margin-top: 20px;
        }
        
        .success { color: #4caf50; font-weight: 600; }
        .error { color: #f44336; font-weight: 600; }
        .info { color: #2196f3; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Cargar Propietarios a Firebase</h1>
        
        <button id="btnCargar" class="btn" onclick="cargarDatos()">
            üì§ Cargar 104 Propietarios
        </button>
        
        <button id="btnLimpiar" class="btn" onclick="limpiarLog()" style="background: linear-gradient(135deg, #9C27B0 0%, #E91E63 100%);">
            üóëÔ∏è Limpiar Log
        </button>
        
        <div id="log"></div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB-RIKKCnOcOctlNDKwM6Enx1Ls-wOMZSo",
            authDomain: "azeche-ph.firebaseapp.com",
            databaseURL: "https://azeche-ph-default-rtdb.firebaseio.com",
            projectId: "azeche-ph",
            storageBucket: "azeche-ph.firebasestorage.app",
            messagingSenderId: "905337990521",
            appId: "1:905337990521:web:c2ca4932672c59fef6c5c9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        function log(mensaje, tipo = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${tipo}">[${timestamp}] ${mensaje}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        window.limpiarLog = function() {
            document.getElementById('log').innerHTML = '';
        };

        window.cargarDatos = async function() {
            const btn = document.getElementById('btnCargar');
            btn.disabled = true;
            btn.textContent = '‚è≥ Cargando...';
            
            log('üöÄ Iniciando carga de datos...', 'info');
            
            try {
                // Cargar JSON
                log('üì• Cargando archivo JSON...', 'info');
                const response = await fetch('datos_propietarios.json');
                const datos = await response.json();
                
                log(`‚úÖ JSON cargado: ${Object.keys(datos.propietarios).length} propietarios`, 'success');
                
                // Cargar a Firebase por edificio
                const edificios = {
                    'nepal-2': 0,
                    'avalon': 0,
                    'convivienda-1': 0,
                    'pinos-del-country': 0
                };
                
                log('', 'info');
                log('üì§ Subiendo a Firebase...', 'info');
                
                for (const [key, propietario] of Object.entries(datos.propietarios)) {
                    const edificio = propietario.edificio;
                    const path = `propietarios/${edificio}/${key}`;
                    
                    await set(ref(db, path), propietario);
                    edificios[edificio]++;
                    
                    if (edificios[edificio] % 10 === 0) {
                        log(`   ${edificio}: ${edificios[edificio]} propietarios...`, 'info');
                    }
                }
                
                log('', 'info');
                log('üéâ ¬°CARGA COMPLETADA!', 'success');
                log('', 'info');
                log(`üìä Resumen por edificio:`, 'info');
                for (const [edificio, cantidad] of Object.entries(edificios)) {
                    log(`   üè¢ ${edificio}: ${cantidad} propietarios`, 'success');
                }
                
                btn.textContent = '‚úÖ Datos Cargados';
                btn.style.background = '#4caf50';
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                btn.disabled = false;
                btn.textContent = 'üîÑ Reintentar';
            }
        };
    </script>
</body>
</html>
