<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Recepci√≥n de Edificios | Azeche PH</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2d3748;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 16px;
        }

        .info-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .info-form h2 {
            color: #2d3748;
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: #4a5568;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .overall-progress {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .progress-bar-container {
            background: #e2e8f0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        .progress-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat {
            flex: 1;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #718096;
            margin-top: 5px;
        }

        .checklist-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 15px 0;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
            user-select: none;
        }

        .section-header:hover {
            background: #f7fafc;
            margin: 0 -15px;
            padding: 15px 15px;
            border-radius: 8px;
        }

        .section-header h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-progress {
            background: #edf2f7;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
        }

        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }

        .collapsed .checklist-items {
            max-height: 0;
            opacity: 0;
        }

        .checklist-item {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #e2e8f0;
            transition: all 0.3s;
        }

        .checklist-item:hover {
            background: #edf2f7;
            border-left-color: #667eea;
        }

        .checklist-item.checked {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .item-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 10px;
        }

        .checkbox-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            appearance: none;
            border: 2px solid #cbd5e0;
            border-radius: 6px;
            transition: all 0.3s;
            position: relative;
        }

        .checkbox-wrapper input[type="checkbox"]:checked {
            background: #48bb78;
            border-color: #48bb78;
        }

        .checkbox-wrapper input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 16px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .item-content {
            flex: 1;
        }

        .item-title {
            color: #2d3748;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .item-description {
            color: #718096;
            font-size: 14px;
            line-height: 1.6;
        }

        .item-notes {
            margin-top: 10px;
        }

        .item-notes textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            min-height: 60px;
        }

        .item-notes textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left: 5px solid #48bb78;
        }

        .notification.error {
            border-left: 5px solid #f56565;
        }

        .collapse-icon {
            transition: transform 0.3s;
            font-size: 12px;
        }

        .collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(255,255,255,0.3);
            transform: translateX(-5px);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="Dashboard.html" class="back-link">
            ‚Üê Volver al Dashboard Azeche PH
        </a>

        <div class="header">
            <h1>üìã Checklist de Recepci√≥n de Edificios</h1>
            <p>Sistema profesional para documentar la recepci√≥n de edificios en propiedad horizontal</p>
        </div>

        <div class="overall-progress">
            <h3 style="color: #2d3748; margin-bottom: 15px; font-weight: 600;">Progreso General</h3>
            <div class="progress-bar-container">
                <div class="progress-bar" id="overallProgressBar" style="width: 0%">0%</div>
            </div>
            <div class="progress-stats">
                <div class="stat">
                    <div class="stat-value" id="completedItems">0</div>
                    <div class="stat-label">Completados</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="totalItems">81</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="progressPercentage">0%</div>
                    <div class="stat-label">Progreso</div>
                </div>
            </div>
        </div>

        <div class="info-form">
            <h2>üìù Informaci√≥n General de la Recepci√≥n</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombreEdificio">Nombre del Edificio *</label>
                    <input type="text" id="nombreEdificio" required placeholder="Ej: Conjunto Avalon">
                </div>
                <div class="form-group">
                    <label for="direccion">Direcci√≥n Completa *</label>
                    <input type="text" id="direccion" required placeholder="Ej: Calle 123 # 45-67">
                </div>
                <div class="form-group">
                    <label for="fechaRecepcion">Fecha de Recepci√≥n *</label>
                    <input type="date" id="fechaRecepcion" required>
                </div>
                <div class="form-group">
                    <label for="horaRecepcion">Hora de Recepci√≥n</label>
                    <input type="time" id="horaRecepcion">
                </div>
                <div class="form-group">
                    <label for="administradorSaliente">Administrador Saliente</label>
                    <input type="text" id="administradorSaliente" placeholder="Nombre completo">
                </div>
                <div class="form-group">
                    <label for="administradorEntrante">Administrador Entrante (Tu nombre) *</label>
                    <input type="text" id="administradorEntrante" required placeholder="Carla Castellano Madriz">
                </div>
                <div class="form-group">
                    <label for="cedulaEntrante">C√©dula Administrador Entrante *</label>
                    <input type="text" id="cedulaEntrante" required placeholder="C.E. 679955">
                </div>
                <div class="form-group">
                    <label for="testigos">Testigos Presentes</label>
                    <input type="text" id="testigos" placeholder="Nombres de testigos separados por comas">
                </div>
            </div>
            <div class="form-group">
                <label for="observacionesGenerales">Observaciones Generales</label>
                <textarea id="observacionesGenerales" placeholder="Cualquier observaci√≥n general sobre la recepci√≥n..."></textarea>
            </div>
        </div>

        <div id="checklistContainer">
            <!-- El checklist se genera aqu√≠ -->
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="guardarBorrador()">
                üíæ Guardar Borrador
            </button>
            <button class="btn btn-success" onclick="generarPDF()">
                üìÑ Generar PDF Profesional
            </button>
        </div>
    </div>

    <div class="notification" id="notification">
        <span id="notificationIcon">‚úì</span>
        <span id="notificationMessage"></span>
    </div>

    <script>
        // Datos del checklist
        const checklistData = {
            "documentacion": {
                title: "üìÑ Documentaci√≥n Legal y Administrativa",
                items: [
                    { id: "doc_01", title: "Escritura de constituci√≥n", description: "Escritura de constituci√≥n del r√©gimen de propiedad horizontal y todas sus reformas" },
                    { id: "doc_02", title: "Reglamento de propiedad horizontal", description: "Reglamento actualizado con todas las normas internas del edificio" },
                    { id: "doc_03", title: "Certificado de libertad y tradici√≥n", description: "Matr√≠cula inmobiliaria matriz actualizada" },
                    { id: "doc_04", title: "Manual de convivencia", description: "Manual aprobado por la asamblea" },
                    { id: "doc_05", title: "Planos arquitect√≥nicos", description: "Planos arquitect√≥nicos y estructurales completos del edificio" },
                    { id: "doc_06", title: "Planos de instalaciones", description: "Planos de instalaciones hidr√°ulicas, el√©ctricas, sanitarias y de gas" },
                    { id: "doc_07", title: "Memoria descriptiva", description: "Memoria descriptiva del edificio con especificaciones t√©cnicas" },
                    { id: "doc_08", title: "Actas de asambleas", description: "Actas de asambleas de los √∫ltimos 2 a√±os m√≠nimo" },
                    { id: "doc_09", title: "Actas del consejo", description: "Actas del consejo de administraci√≥n" },
                    { id: "doc_10", title: "Certificado de inscripci√≥n", description: "Certificado de inscripci√≥n ante la Alcald√≠a Local" },
                    { id: "doc_11", title: "Lista de propietarios", description: "Lista actualizada con coeficientes de copropiedad" },
                    { id: "doc_12", title: "Lista de residentes", description: "Lista actual de residentes y arrendatarios" }
                ]
            },
            "financiero": {
                title: "üí∞ Informaci√≥n Financiera",
                items: [
                    { id: "fin_01", title: "Estados financieros", description: "Estados financieros de los √∫ltimos 12 meses" },
                    { id: "fin_02", title: "Presupuesto vigente", description: "Presupuesto actual aprobado por la asamblea" },
                    { id: "fin_03", title: "Balance general", description: "Balance general y cuenta de resultados" },
                    { id: "fin_04", title: "Corte de caja", description: "Corte de caja con saldos actuales en bancos" },
                    { id: "fin_05", title: "Libros contables", description: "Libro de contabilidad o sistema de registros" },
                    { id: "fin_06", title: "Certificaciones bancarias", description: "Certificaciones de todas las cuentas bancarias" },
                    { id: "fin_07", title: "Cuotas de administraci√≥n", description: "Relaci√≥n de cuotas ordinarias y extraordinarias" },
                    { id: "fin_08", title: "Cartera morosa", description: "Listado detallado de morosos con antig√ºedad" },
                    { id: "fin_09", title: "Fondos especiales", description: "Saldos de fondo de reserva e imprevistos" },
                    { id: "fin_10", title: "Cuentas por pagar", description: "Relaci√≥n completa de cuentas por pagar" },
                    { id: "fin_11", title: "Anticipos recibidos", description: "Anticipos de cuotas extraordinarias" }
                ]
            },
            "contratos": {
                title: "üìë Contratos y Proveedores",
                items: [
                    { id: "con_01", title: "Lista de proveedores", description: "Lista completa de proveedores activos" },
                    { id: "con_02", title: "Contrato de vigilancia", description: "Contrato vigente de seguridad" },
                    { id: "con_03", title: "Contrato de aseo", description: "Contrato de servicios de aseo y jardiner√≠a" },
                    { id: "con_04", title: "Contrato ascensores", description: "Contrato de mantenimiento de ascensores" },
                    { id: "con_05", title: "Contrato piscina", description: "Contrato de mantenimiento de piscina (si aplica)" },
                    { id: "con_06", title: "Contratos de mantenimiento", description: "Contratos de mantenimiento de equipos" },
                    { id: "con_07", title: "P√≥lizas de seguro", description: "P√≥lizas: incendio, terremoto, responsabilidad" },
                    { id: "con_08", title: "Contratos servicios p√∫blicos", description: "Contratos con empresas de servicios" },
                    { id: "con_09", title: "Garant√≠as vigentes", description: "Garant√≠as de equipos y sistemas" }
                ]
            },
            "personal": {
                title: "üë• Personal y Laboral",
                items: [
                    { id: "per_01", title: "Contratos laborales", description: "Contratos de todo el personal directo" },
                    { id: "per_02", title: "Afiliaciones seguridad social", description: "Afiliaciones EPS, pensi√≥n, ARL y caja" },
                    { id: "per_03", title: "Finiquitos anteriores", description: "Finiquitos de empleados que terminaron" },
                    { id: "per_04", title: "Dotaciones", description: "Estado de dotaciones entregadas" },
                    { id: "per_05", title: "Vacaciones causadas", description: "Registro de vacaciones causadas" },
                    { id: "per_06", title: "Cesant√≠as", description: "Comprobantes de consignaci√≥n" }
                ]
            },
            "tecnico": {
                title: "üîß Bit√°coras y Mantenimientos",
                items: [
                    { id: "tec_01", title: "Bit√°cora general", description: "Bit√°cora de mantenimientos preventivos y correctivos" },
                    { id: "tec_02", title: "Cronogramas mantenimiento", description: "Cronogramas de mantenimiento preventivo" },
                    { id: "tec_03", title: "Certificado bombas", description: "Certificaciones de revisi√≥n de bombas" },
                    { id: "tec_04", title: "Certificado planta el√©ctrica", description: "Certificaciones de planta el√©ctrica" },
                    { id: "tec_05", title: "Certificado ascensores", description: "Certificaciones t√©cnicas de ascensores" },
                    { id: "tec_06", title: "Certificado extintores", description: "Certificaciones de extintores" },
                    { id: "tec_07", title: "Certificado contra incendios", description: "Certificaciones del sistema contra incendios" },
                    { id: "tec_08", title: "Certificado tanques agua", description: "Certificado de limpieza de tanques" },
                    { id: "tec_09", title: "Certificado sistema el√©ctrico", description: "Revisi√≥n t√©cnica del sistema el√©ctrico" },
                    { id: "tec_10", title: "Certificado sistema gas", description: "Certificaci√≥n del sistema de gas" }
                ]
            },
            "inventario": {
                title: "üì¶ Inventario de Bienes Comunes",
                items: [
                    { id: "inv_01", title: "√Åreas comunes", description: "Inventario de todas las √°reas comunes" },
                    { id: "inv_02", title: "Mobiliario", description: "Inventario de mobiliario completo" },
                    { id: "inv_03", title: "Equipamiento", description: "Equipamiento general del edificio" },
                    { id: "inv_04", title: "Herramientas", description: "Herramientas y equipos de mantenimiento" },
                    { id: "inv_05", title: "Veh√≠culos", description: "Veh√≠culos de la copropiedad" },
                    { id: "inv_06", title: "Sistemas de seguridad", description: "C√°maras, controles de acceso, alarmas" },
                    { id: "inv_07", title: "Sistemas electromec√°nicos", description: "Ascensores, bombas, plantas, portones" },
                    { id: "inv_08", title: "Llaves y accesos", description: "Inventario completo de llaves" },
                    { id: "inv_09", title: "C√≥digos de acceso", description: "C√≥digos de alarmas y sistemas digitales" }
                ]
            },
            "servicios": {
                title: "üîå Servicios P√∫blicos",
                items: [
                    { id: "ser_01", title: "Facturas pagadas", description: "√öltimas facturas de todos los servicios" },
                    { id: "ser_02", title: "Verificaci√≥n deudas", description: "Verificaci√≥n de que no existen deudas" },
                    { id: "ser_03", title: "Contratos servicios", description: "Contratos con empresas de servicios" },
                    { id: "ser_04", title: "Medidores", description: "Identificaci√≥n y ubicaci√≥n de medidores" }
                ]
            },
            "legal": {
                title: "‚öñÔ∏è Asuntos Legales",
                items: [
                    { id: "leg_01", title: "Procesos judiciales", description: "Estado de procesos judiciales en curso" },
                    { id: "leg_02", title: "Demandas ejecutivas", description: "Demandas ejecutivas por cobro de cuotas" },
                    { id: "leg_03", title: "Procesos disciplinarios", description: "Procesos contra copropietarios" },
                    { id: "leg_04", title: "Sanciones pendientes", description: "Sanciones pendientes de aplicar" },
                    { id: "leg_05", title: "Reclamaciones seguros", description: "Reclamaciones ante compa√±√≠as de seguros" }
                ]
            },
            "inspeccion": {
                title: "üèóÔ∏è Inspecci√≥n F√≠sica",
                items: [
                    { id: "ins_01", title: "Recorrido completo", description: "Recorrido por todas las √°reas del edificio" },
                    { id: "ins_02", title: "Verificaci√≥n instalaciones", description: "Verificaci√≥n del estado de instalaciones" },
                    { id: "ins_03", title: "Prueba de equipos", description: "Comprobaci√≥n de funcionamiento de equipos" },
                    { id: "ins_04", title: "Registro fotogr√°fico", description: "Fotograf√≠as como evidencia del estado" },
                    { id: "ins_05", title: "Identificaci√≥n reparaciones", description: "Identificaci√≥n de reparaciones urgentes" }
                ]
            }
        };

        // Inicializar
        function init() {
            renderChecklist();
            loadFromLocalStorage();
            updateProgress();
            setDefaultDate();
            startAutoSave();
        }

        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fechaRecepcion').value = today;
        }

        function renderChecklist() {
            const container = document.getElementById('checklistContainer');
            let html = '';

            Object.keys(checklistData).forEach(sectionKey => {
                const section = checklistData[sectionKey];
                
                html += `
                    <div class="checklist-section" data-section="${sectionKey}">
                        <div class="section-header" onclick="toggleSection('${sectionKey}')">
                            <h3>
                                <span class="collapse-icon">‚ñº</span>
                                ${section.title}
                            </h3>
                            <span class="section-progress" id="progress-${sectionKey}">0/${section.items.length}</span>
                        </div>
                        <div class="checklist-items">
                            ${section.items.map(item => `
                                <div class="checklist-item" id="item-${item.id}">
                                    <div class="item-header">
                                        <div class="checkbox-wrapper">
                                            <input type="checkbox" 
                                                   id="check-${item.id}" 
                                                   onchange="handleCheckboxChange('${item.id}')">
                                        </div>
                                        <div class="item-content">
                                            <div class="item-title">${item.title}</div>
                                            <div class="item-description">${item.description}</div>
                                        </div>
                                    </div>
                                    <div class="item-notes">
                                        <textarea id="notes-${item.id}" 
                                                  placeholder="Notas, observaciones o ubicaci√≥n del documento..."
                                                  onchange="handleNotesChange('${item.id}')"></textarea>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function toggleSection(sectionKey) {
            const section = document.querySelector(`[data-section="${sectionKey}"]`);
            section.classList.toggle('collapsed');
        }

        function handleCheckboxChange(itemId) {
            const checkbox = document.getElementById(`check-${itemId}`);
            const item = document.getElementById(`item-${itemId}`);
            
            if (checkbox.checked) {
                item.classList.add('checked');
            } else {
                item.classList.remove('checked');
            }
            
            updateProgress();
            saveToLocalStorage();
        }

        function handleNotesChange(itemId) {
            saveToLocalStorage();
        }

        function updateProgress() {
            let totalCompleted = 0;
            let totalItems = 0;

            Object.keys(checklistData).forEach(sectionKey => {
                const section = checklistData[sectionKey];
                let sectionCompleted = 0;

                section.items.forEach(item => {
                    totalItems++;
                    const checkbox = document.getElementById(`check-${item.id}`);
                    if (checkbox && checkbox.checked) {
                        sectionCompleted++;
                        totalCompleted++;
                    }
                });

                const progressSpan = document.getElementById(`progress-${sectionKey}`);
                if (progressSpan) {
                    progressSpan.textContent = `${sectionCompleted}/${section.items.length}`;
                }
            });

            const percentage = totalItems > 0 ? Math.round((totalCompleted / totalItems) * 100) : 0;
            
            document.getElementById('overallProgressBar').style.width = `${percentage}%`;
            document.getElementById('overallProgressBar').textContent = `${percentage}%`;
            document.getElementById('completedItems').textContent = totalCompleted;
            document.getElementById('progressPercentage').textContent = `${percentage}%`;
        }

        function saveToLocalStorage() {
            const data = collectFormData();
            localStorage.setItem('checklistRecepcion', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('checklistRecepcion');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    restoreFormData(data);
                    showNotification('‚úÖ Datos cargados del guardado anterior', 'success');
                } catch (e) {
                    console.error('Error cargando datos:', e);
                }
            }
        }

        function collectFormData() {
            const data = {
                informacionGeneral: {
                    nombreEdificio: document.getElementById('nombreEdificio').value,
                    direccion: document.getElementById('direccion').value,
                    fechaRecepcion: document.getElementById('fechaRecepcion').value,
                    horaRecepcion: document.getElementById('horaRecepcion').value,
                    administradorSaliente: document.getElementById('administradorSaliente').value,
                    administradorEntrante: document.getElementById('administradorEntrante').value,
                    cedulaEntrante: document.getElementById('cedulaEntrante').value,
                    testigos: document.getElementById('testigos').value,
                    observacionesGenerales: document.getElementById('observacionesGenerales').value
                },
                checklist: {},
                timestamp: new Date().toISOString()
            };

            Object.keys(checklistData).forEach(sectionKey => {
                const section = checklistData[sectionKey];
                section.items.forEach(item => {
                    const checkbox = document.getElementById(`check-${item.id}`);
                    const notes = document.getElementById(`notes-${item.id}`);
                    
                    data.checklist[item.id] = {
                        checked: checkbox ? checkbox.checked : false,
                        notes: notes ? notes.value : '',
                        title: item.title,
                        description: item.description
                    };
                });
            });

            return data;
        }

        function restoreFormData(data) {
            if (data.informacionGeneral) {
                const info = data.informacionGeneral;
                Object.keys(info).forEach(key => {
                    const element = document.getElementById(key);
                    if (element && info[key]) {
                        element.value = info[key];
                    }
                });
            }

            if (data.checklist) {
                Object.keys(data.checklist).forEach(itemId => {
                    const itemData = data.checklist[itemId];
                    const checkbox = document.getElementById(`check-${itemId}`);
                    const notes = document.getElementById(`notes-${itemId}`);
                    const item = document.getElementById(`item-${itemId}`);
                    
                    if (checkbox) {
                        checkbox.checked = itemData.checked;
                        if (itemData.checked && item) {
                            item.classList.add('checked');
                        }
                    }
                    
                    if (notes && itemData.notes) {
                        notes.value = itemData.notes;
                    }
                });
            }

            updateProgress();
        }

        function startAutoSave() {
            // Auto-guardar cada 30 segundos
            setInterval(() => {
                saveToLocalStorage();
            }, 30000);
        }

        function guardarBorrador() {
            saveToLocalStorage();
            showNotification('üíæ Borrador guardado correctamente', 'success');
        }

        function descargarJSON() {
            const data = collectFormData();
            
            if (!data.informacionGeneral.nombreEdificio) {
                showNotification('‚ùå Por favor completa el nombre del edificio', 'error');
                return;
            }

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const filename = `checklist-${data.informacionGeneral.nombreEdificio.replace(/\s+/g, '-')}-${data.informacionGeneral.fechaRecepcion}.json`;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('‚úÖ Checklist descargado correctamente', 'success');
        }

        function generarPDF() {
            const data = collectFormData();
            
            // Validar campos obligatorios
            if (!data.informacionGeneral.nombreEdificio || !data.informacionGeneral.direccion || !data.informacionGeneral.administradorEntrante) {
                showNotification('‚ùå Por favor completa los campos obligatorios (Nombre del Edificio, Direcci√≥n, Administrador Entrante)', 'error');
                return;
            }

            showNotification('üìÑ Generando PDF profesional...', 'success');

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let yPos = 20;
            const pageWidth = doc.internal.pageSize.width;
            const marginLeft = 20;
            const marginRight = 20;
            const maxWidth = pageWidth - marginLeft - marginRight;

            // Funci√≥n para agregar nueva p√°gina si es necesario
            function checkNewPage(requiredSpace = 20) {
                if (yPos + requiredSpace > 280) {
                    doc.addPage();
                    yPos = 20;
                    return true;
                }
                return false;
            }

            // Encabezado principal
            doc.setFillColor(102, 126, 234);
            doc.rect(0, 0, pageWidth, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text('ACTA DE RECEPCI√ìN DE EDIFICIO', pageWidth / 2, 15, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text('Propiedad Horizontal - Compliance Pro', pageWidth / 2, 25, { align: 'center' });
            doc.text(`Fecha de generaci√≥n: ${new Date().toLocaleDateString('es-CO')}`, pageWidth / 2, 33, { align: 'center' });

            yPos = 50;

            // INFORMACI√ìN GENERAL
            doc.setTextColor(0, 0, 0);
            doc.setFillColor(237, 242, 247);
            doc.rect(marginLeft - 5, yPos - 5, maxWidth + 10, 10, 'F');
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('INFORMACI√ìN GENERAL DE LA RECEPCI√ìN', marginLeft, yPos);
            
            yPos += 15;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');

            const info = data.informacionGeneral;
            const infoItems = [
                ['Nombre del Edificio:', info.nombreEdificio],
                ['Direcci√≥n:', info.direccion],
                ['Fecha de Recepci√≥n:', info.fechaRecepcion],
                ['Hora de Recepci√≥n:', info.horaRecepcion || 'No especificada'],
                ['Administrador Saliente:', info.administradorSaliente || 'No especificado'],
                ['Administrador Entrante:', info.administradorEntrante],
                ['C√©dula Administrador:', info.cedulaEntrante],
                ['Testigos:', info.testigos || 'No especificados']
            ];

            infoItems.forEach(([label, value]) => {
                checkNewPage();
                doc.setFont(undefined, 'bold');
                doc.text(label, marginLeft, yPos);
                doc.setFont(undefined, 'normal');
                doc.text(value, marginLeft + 55, yPos);
                yPos += 7;
            });

            if (info.observacionesGenerales) {
                yPos += 3;
                checkNewPage(20);
                doc.setFont(undefined, 'bold');
                doc.text('Observaciones Generales:', marginLeft, yPos);
                yPos += 7;
                doc.setFont(undefined, 'normal');
                const obsLines = doc.splitTextToSize(info.observacionesGenerales, maxWidth - 10);
                obsLines.forEach(line => {
                    checkNewPage();
                    doc.text(line, marginLeft + 5, yPos);
                    yPos += 5;
                });
            }

            yPos += 10;

            // ESTAD√çSTICAS DEL CHECKLIST
            let totalItems = 0;
            let completedItems = 0;
            Object.keys(checklistData).forEach(sectionKey => {
                checklistData[sectionKey].items.forEach(item => {
                    totalItems++;
                    if (data.checklist[item.id] && data.checklist[item.id].checked) {
                        completedItems++;
                    }
                });
            });

            const percentage = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;

            checkNewPage(25);
            doc.setFillColor(237, 242, 247);
            doc.rect(marginLeft - 5, yPos - 5, maxWidth + 10, 20, 'F');
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('RESUMEN DEL CHECKLIST', marginLeft, yPos);
            yPos += 10;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Items Completados: ${completedItems} de ${totalItems} (${percentage}%)`, marginLeft, yPos);
            
            yPos += 15;

            // DETALLE DEL CHECKLIST POR SECCIONES
            Object.keys(checklistData).forEach(sectionKey => {
                const section = checklistData[sectionKey];
                
                checkNewPage(30);
                
                // T√≠tulo de secci√≥n
                doc.setFillColor(102, 126, 234);
                doc.rect(marginLeft - 5, yPos - 6, maxWidth + 10, 10, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(section.title, marginLeft, yPos);
                
                yPos += 12;
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(9);

                // Items de la secci√≥n
                section.items.forEach((item, index) => {
                    const itemData = data.checklist[item.id];
                    const isChecked = itemData && itemData.checked;
                    const hasNotes = itemData && itemData.notes;

                    checkNewPage(hasNotes ? 25 : 12);

                    // Checkbox visual
                    doc.setDrawColor(200, 200, 200);
                    doc.rect(marginLeft, yPos - 3, 4, 4);
                    if (isChecked) {
                        doc.setFillColor(72, 187, 120);
                        doc.rect(marginLeft, yPos - 3, 4, 4, 'F');
                        doc.setTextColor(72, 187, 120);
                        doc.setFont(undefined, 'bold');
                        doc.text('‚úì', marginLeft + 0.5, yPos);
                        doc.setTextColor(0, 0, 0);
                    }

                    // T√≠tulo del item
                    doc.setFont(undefined, isChecked ? 'bold' : 'normal');
                    const titleLines = doc.splitTextToSize(item.title, maxWidth - 10);
                    doc.text(titleLines[0], marginLeft + 7, yPos);
                    
                    yPos += 5;
                    
                    // Descripci√≥n
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(100, 100, 100);
                    const descLines = doc.splitTextToSize(item.description, maxWidth - 10);
                    descLines.forEach(line => {
                        checkNewPage();
                        doc.text(line, marginLeft + 7, yPos);
                        yPos += 4;
                    });

                    // Notas si existen
                    if (hasNotes) {
                        yPos += 2;
                        doc.setTextColor(0, 0, 0);
                        doc.setFont(undefined, 'italic');
                        doc.text('Notas:', marginLeft + 7, yPos);
                        yPos += 4;
                        const notesLines = doc.splitTextToSize(itemData.notes, maxWidth - 12);
                        notesLines.forEach(line => {
                            checkNewPage();
                            doc.text(line, marginLeft + 12, yPos);
                            yPos += 4;
                        });
                    }

                    doc.setTextColor(0, 0, 0);
                    yPos += 4;
                });

                yPos += 5;
            });

            // P√ÅGINA DE FIRMAS
            doc.addPage();
            yPos = 20;

            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('FIRMAS Y DECLARACIONES', pageWidth / 2, yPos, { align: 'center' });
            
            yPos += 20;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');

            const declaracion = 'Por medio de la presente, declaro que he recibido el edificio antes mencionado en las condiciones descritas en este documento. He verificado el estado de los bienes comunes, la documentaci√≥n entregada y confirmo que la informaci√≥n contenida en este checklist corresponde a la realidad al momento de la recepci√≥n.';
            const declLines = doc.splitTextToSize(declaracion, maxWidth);
            declLines.forEach(line => {
                doc.text(line, marginLeft, yPos);
                yPos += 6;
            });

            yPos += 20;

            // Firma Administrador Entrante
            doc.setFont(undefined, 'bold');
            doc.text('ADMINISTRADOR ENTRANTE:', marginLeft, yPos);
            yPos += 20;
            doc.line(marginLeft, yPos, marginLeft + 70, yPos);
            yPos += 5;
            doc.setFont(undefined, 'normal');
            doc.text(info.administradorEntrante, marginLeft, yPos);
            yPos += 5;
            doc.text(`C.E./C.C. ${info.cedulaEntrante}`, marginLeft, yPos);

            // Firma Administrador Saliente
            if (info.administradorSaliente) {
                yPos += 25;
                doc.setFont(undefined, 'bold');
                doc.text('ADMINISTRADOR SALIENTE:', marginLeft, yPos);
                yPos += 20;
                doc.line(marginLeft, yPos, marginLeft + 70, yPos);
                yPos += 5;
                doc.setFont(undefined, 'normal');
                doc.text(info.administradorSaliente, marginLeft, yPos);
            }

            // Testigos
            if (info.testigos) {
                yPos += 25;
                doc.setFont(undefined, 'bold');
                doc.text('TESTIGOS:', marginLeft, yPos);
                yPos += 7;
                doc.setFont(undefined, 'normal');
                const testigos = info.testigos.split(',').map(t => t.trim());
                testigos.forEach((testigo, i) => {
                    if (i > 0) yPos += 15;
                    yPos += 13;
                    doc.line(marginLeft, yPos, marginLeft + 70, yPos);
                    yPos += 5;
                    doc.text(testigo, marginLeft, yPos);
                });
            }

            // Footer en cada p√°gina
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text(`Compliance Pro - Carla Castellano Madriz C.E. 679955`, marginLeft, 290);
                doc.text(`P√°gina ${i} de ${totalPages}`, pageWidth - marginRight, 290, { align: 'right' });
            }

            // Guardar PDF
            const filename = `Acta-Recepcion-${info.nombreEdificio.replace(/\s+/g, '-')}-${info.fechaRecepcion}.pdf`;
            doc.save(filename);
            
            showNotification('‚úÖ PDF generado y descargado correctamente', 'success');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notificationMessage');
            const notificationIcon = document.getElementById('notificationIcon');
            
            notificationMessage.textContent = message;
            notification.className = `notification ${type}`;
            notificationIcon.textContent = type === 'success' ? '‚úì' : '‚úï';
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // Guardar antes de cerrar
        window.addEventListener('beforeunload', () => {
            saveToLocalStorage();
        });

        // Inicializar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Log para debug
        console.log('‚úÖ Checklist de Recepci√≥n cargado correctamente');
        console.log('üìä Total de secciones:', Object.keys(checklistData).length);
        console.log('üìã Total de items:', Object.values(checklistData).reduce((sum, section) => sum + section.items.length, 0));
    </script>
</body>
</html>
